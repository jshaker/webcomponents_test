<script>

    var ShakerNavProto = Object.create(HTMLElement.prototype);
    ShakerNavProto.shadows = {};

    ShakerNavProto.createdCallback = function(){
        var shadow = this.createShadowRoot();
        this.shadows[this.id] = shadow;
        var importDocument = document.querySelector('link[rel="import"]').import;
        var template = importDocument.querySelector('#shaker-nav');
        var templateContent = document.importNode(template.content, true);
        var attributes = this.dataset;
        if(attributes.navelements){
            var nav = templateContent.querySelector('.mdl-navigation');
            var navElements = JSON.parse(attributes.navelements);
            navElements.forEach(function(element){
                nav.innerHTML += "<a class='mdl-navigation__link' href='"+element.href+"'>"+element.label+"<\a>";
            });
        }
        if(attributes.title){
            templateContent.querySelector('.mdl-layout-title').innerHTML = attributes.title;
        }
        shadow.appendChild(templateContent);
    };

    ShakerNavProto.attachedCallback = function(){
        var shakerNav = document.querySelector('shaker-nav#'+this.id);
        shakerNav.setNavElements = function(navelements){
            this.setAttribute('data-navelements',JSON.stringify(navelements));
        };
        shakerNav.setTitle = function(title){
            this.setAttribute('data-title', title);
        };
    };

    ShakerNavProto.attributeChangedCallback = function(attrName, oldVal, newVal){
        switch(attrName){
            case "data-title":          this.shadows[this.id].querySelector('.mdl-layout-title').innerHTML = newVal;
                                        return;
            case "data-navelements":    var nav = this.shadows[this.id].querySelector('.mdl-navigation');
                                        while (nav.firstChild) {
                                            nav.removeChild(nav.firstChild);
                                        }
                                        var navElements = JSON.parse(newVal);
                                        navElements.forEach(function(element){
                                            nav.innerHTML += "<a class='mdl-navigation__link' href='"+element.href+"'>"+element.label+"<\a>";
                                        });
                                        return;
        }


    };

    document.registerElement('shaker-nav', {
        prototype: ShakerNavProto
    });

</script>

<template id="shaker-nav">

    <style> @import "bower_components/material-design-lite/material.min.css"; </style>
    <div class="mdl-layout--fixed-drawer">
        <div class="mdl-layout__drawer">
            <span class="mdl-layout-title">Title</span>
            <nav class="mdl-navigation">
            </nav>
        </div>
    </div>

</template>

